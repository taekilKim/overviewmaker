<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overviewer for BOSS GOLF</title>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "Pretendard",
                "Inter",
                "ui-sans-serif",
                "system-ui",
                "-apple-system",
                "BlinkMacSystemFont",
                "Segoe UI",
                "Roboto",
                "Helvetica Neue",
                "Arial",
                "sans-serif",
              ],
            },
            colors: {
              border: "hsl(214.3 31.8% 91.4%)",
              input: "hsl(214.3 31.8% 91.4%)",
              ring: "hsl(215 20.2% 65.1%)",
              background: "hsl(0 0% 100%)",
              foreground: "hsl(222.2 84% 4.9%)",
              primary: {
                DEFAULT: "hsl(222.2 47.4% 11.2%)",
                foreground: "hsl(210 40% 98%)",
              },
              muted: {
                DEFAULT: "hsl(210 40% 96.1%)",
                foreground: "hsl(215.4 16.3% 46.9%)",
              },
              card: {
                DEFAULT: "hsl(0 0% 100%)",
                foreground: "hsl(222.2 84% 4.9%)",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #ffffff;
        color: #020617;
        font-family: "Pretendard", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body class="min-h-screen bg-background text-foreground">
    <header class="w-full h-16 px-4 md:px-8 border-b border-border flex justify-between items-center bg-white/80 backdrop-blur-md sticky top-0 z-40">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-primary text-primary-foreground flex items-center justify-center font-bold tracking-tighter text-xs rounded-md shadow-sm">BG</div>
        <div class="flex flex-col justify-center">
          <h1 class="text-lg font-bold tracking-tight leading-none">
            Anywear <span class="font-normal text-slate-500 text-sm ml-1">for BOSS GOLF</span>
          </h1>
        </div>
      </div>
      <div class="hidden md:inline-flex items-center gap-2 px-3 py-2 rounded-full border border-slate-200 bg-white text-slate-700 text-sm font-medium">
        Overviewer
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 md:px-8 py-6 md:py-8 grid grid-cols-1 lg:grid-cols-3 gap-6 animate-[fadeIn_0.3s_ease-out]">
      <section class="lg:col-span-2 rounded-2xl border border-border bg-card shadow-sm overflow-hidden">
        <div class="px-5 py-4 border-b border-border bg-slate-50">
          <h2 class="text-base font-semibold text-slate-900">PPT 생성</h2>
          <p class="mt-1 text-xs text-slate-500">Streamlit 입력 구조를 그대로 유지한 웹 UI입니다.</p>
        </div>

        <div class="p-5 space-y-4">
          <div>
            <label for="apiBase" class="block text-xs font-medium text-slate-600 mb-1.5">API Base URL</label>
            <input id="apiBase" value="https://overviewmaker.onrender.com" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label for="season_item" class="block text-xs font-medium text-slate-600 mb-1.5">시즌 아이템명</label>
              <input id="season_item" value="JETSET LUXE" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
            <div>
              <label for="season_color" class="block text-xs font-medium text-slate-600 mb-1.5">시즌 색상</label>
              <input id="season_color" value="#000000" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
            <div>
              <label for="name" class="block text-xs font-medium text-slate-600 mb-1.5">카테고리</label>
              <input id="name" value="MEN'S T-SHIRTS" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
            <div>
              <label for="code" class="block text-xs font-medium text-slate-600 mb-1.5">품번</label>
              <input id="code" value="MFTS-02" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
            <div>
              <label for="logo" class="block text-xs font-medium text-slate-600 mb-1.5">로고 파일명</label>
              <input id="logo" value="선택 없음" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
            <div>
              <label for="artworks" class="block text-xs font-medium text-slate-600 mb-1.5">아트워크 파일명들(콤마)</label>
              <input id="artworks" placeholder="art1.png,art2.png" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
            </div>
          </div>

          <div>
            <label for="color_names" class="block text-xs font-medium text-slate-600 mb-1.5">컬러 이름들(콤마)</label>
            <input id="color_names" placeholder="BLACK,BEIGE" class="w-full rounded-lg border border-input px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
          </div>

          <div class="rounded-xl border border-dashed border-slate-300 bg-slate-50 p-3">
            <label for="main_image" class="block text-xs font-medium text-slate-700 mb-1.5">메인 이미지</label>
            <input id="main_image" type="file" accept=".png,.jpg,.jpeg" class="w-full text-sm" />
            <p id="mainImageHint" class="mt-1.5 text-xs text-slate-500">아직 파일이 선택되지 않았습니다.</p>
          </div>

          <div class="rounded-xl border border-dashed border-slate-300 bg-slate-50 p-3">
            <label for="color_images" class="block text-xs font-medium text-slate-700 mb-1.5">컬러웨이 이미지들</label>
            <input id="color_images" type="file" accept=".png,.jpg,.jpeg" multiple class="w-full text-sm" />
            <div id="colorPreview" class="mt-2 flex flex-wrap gap-2"></div>
          </div>

          <div class="pt-1">
            <button id="generateBtn" class="w-full md:w-auto inline-flex justify-center items-center px-4 py-2.5 rounded-lg bg-slate-900 text-white text-sm font-semibold hover:bg-slate-800 disabled:opacity-60 disabled:cursor-not-allowed">
              PPT 생성 및 다운로드
            </button>
            <p id="status" class="mt-2 text-sm text-slate-600"></p>
          </div>
        </div>
      </section>

      <aside class="lg:col-span-1">
        <div class="rounded-2xl border border-border bg-card shadow-sm overflow-hidden lg:sticky lg:top-24">
          <div class="px-5 py-4 border-b border-border bg-slate-50">
            <h3 class="text-sm font-semibold text-slate-900">요약</h3>
            <p class="mt-1 text-xs text-slate-500">생성 전 입력값 체크</p>
          </div>
          <div class="p-5 space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <div class="rounded-xl border border-slate-200 bg-slate-50 p-3">
                <p class="text-[11px] text-slate-500">Colorway Count</p>
                <p id="kColorCount" class="mt-1 text-lg font-semibold text-slate-900">0</p>
              </div>
              <div class="rounded-xl border border-slate-200 bg-slate-50 p-3">
                <p class="text-[11px] text-slate-500">Artwork Count</p>
                <p id="kArtworkCount" class="mt-1 text-lg font-semibold text-slate-900">0</p>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-600 mb-1.5">생성 파일명</label>
              <input value="BOSS_Golf_SpecSheet.pptx" readonly class="w-full rounded-lg border border-input px-3 py-2 text-sm bg-slate-50 text-slate-600" />
            </div>
          </div>
        </div>
      </aside>
    </main>

    <script>
      const $ = (id) => document.getElementById(id);

      const mainImageInput = $("main_image");
      const colorImagesInput = $("color_images");
      const artworksInput = $("artworks");
      const colorPreview = $("colorPreview");
      const statusEl = $("status");
      const kColorCount = $("kColorCount");
      const kArtworkCount = $("kArtworkCount");

      function setStatus(text, tone) {
        statusEl.textContent = text;
        statusEl.className = "mt-2 text-sm ";
        if (tone === "error") {
          statusEl.className += "text-red-600";
        } else if (tone === "success") {
          statusEl.className += "text-emerald-600";
        } else {
          statusEl.className += "text-slate-600";
        }
      }

      function syncSummary() {
        const colorFiles = colorImagesInput.files ? colorImagesInput.files.length : 0;
        const artworkCount = (artworksInput.value || "")
          .split(",")
          .map((v) => v.trim())
          .filter(Boolean).length;

        kColorCount.textContent = String(colorFiles);
        kArtworkCount.textContent = String(artworkCount);
      }

      mainImageInput.addEventListener("change", () => {
        const f = mainImageInput.files && mainImageInput.files[0];
        $("mainImageHint").textContent = f ? `선택됨: ${f.name}` : "아직 파일이 선택되지 않았습니다.";
      });

      colorImagesInput.addEventListener("change", () => {
        colorPreview.innerHTML = "";
        const files = colorImagesInput.files || [];
        for (const f of files) {
          const chip = document.createElement("span");
          chip.className = "inline-flex items-center rounded-full border border-slate-200 bg-white px-2.5 py-1 text-xs text-slate-700";
          chip.textContent = f.name;
          colorPreview.appendChild(chip);
        }
        syncSummary();
      });

      artworksInput.addEventListener("input", syncSummary);

      $("generateBtn").addEventListener("click", async () => {
        const mainImage = mainImageInput.files && mainImageInput.files[0];
        if (!mainImage) {
          alert("메인 이미지 파일은 필수입니다.");
          return;
        }

        const apiBase = $("apiBase").value.trim().replace(/\/$/, "");
        const fd = new FormData();
        fd.append("season_item", $("season_item").value || "");
        fd.append("season_color", $("season_color").value || "#000000");
        fd.append("name", $("name").value || "");
        fd.append("code", $("code").value || "");
        fd.append("logo", $("logo").value || "선택 없음");
        fd.append("artworks", artworksInput.value || "");
        fd.append("color_names", $("color_names").value || "");
        fd.append("main_image", mainImage);

        const colorFiles = colorImagesInput.files || [];
        for (const f of colorFiles) {
          fd.append("color_images", f);
        }

        const btn = $("generateBtn");
        btn.disabled = true;
        setStatus("생성 중...", "");

        try {
          const res = await fetch(`${apiBase}/api/generate`, {
            method: "POST",
            body: fd,
          });

          if (!res.ok) {
            const text = await res.text();
            throw new Error(`${res.status} ${text}`);
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "BOSS_Golf_SpecSheet.pptx";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);

          setStatus("완료: PPT 다운로드를 확인하세요.", "success");
        } catch (e) {
          setStatus(`실패: ${e.message}`, "error");
        } finally {
          btn.disabled = false;
        }
      });

      syncSummary();
    </script>
  </body>
</html>
