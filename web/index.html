<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overviewer for BOSS GOLF</title>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Pretendard', 'Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
            },
            colors: {
              border: 'hsl(214.3 31.8% 91.4%)',
              input: 'hsl(214.3 31.8% 91.4%)',
              ring: 'hsl(215 20.2% 65.1%)',
              background: 'hsl(0 0% 100%)',
              foreground: 'hsl(222.2 84% 4.9%)',
              primary: {
                DEFAULT: 'hsl(222.2 47.4% 11.2%)',
                foreground: 'hsl(210 40% 98%)',
              },
              secondary: {
                DEFAULT: 'hsl(210 40% 96.1%)',
                foreground: 'hsl(222.2 47.4% 11.2%)',
              },
              muted: {
                DEFAULT: 'hsl(210 40% 96.1%)',
                foreground: 'hsl(215.4 16.3% 46.9%)',
              },
              card: {
                DEFAULT: 'hsl(0 0% 100%)',
                foreground: 'hsl(222.2 84% 4.9%)',
              },
            },
            borderRadius: {
              lg: '0.5rem',
              md: 'calc(0.5rem - 2px)',
              sm: 'calc(0.5rem - 4px)',
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen bg-background text-foreground font-sans antialiased">
    <header class="sticky top-0 z-40 flex h-14 items-center border-b border-border bg-background/95 px-4 md:px-6 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div class="flex items-center gap-3">
        <img src="/assets/bossgolf.svg" alt="BOSS Golf" class="h-5 w-auto" />
        <h1 class="text-sm font-semibold tracking-tight">
          Overviewer <span class="font-normal text-muted-foreground">for BOSS GOLF</span>
        </h1>
      </div>
    </header>

    <div class="group/sidebar-wrapper flex min-h-[calc(100vh-56px)] w-full">
      <aside data-sidebar="sidebar" class="w-full max-w-[260px] border-r border-border bg-background">
        <div data-sidebar="content" class="flex h-full flex-col px-3 py-4">
          <div class="mb-4 px-2">
            <img src="/assets/bossgolf.svg" alt="BOSS Golf" class="h-10 w-auto" />
          </div>
          <nav data-sidebar="group" class="space-y-1">
            <button id="menu-editor" class="flex w-full items-center rounded-md border border-primary bg-primary px-3 py-2 text-sm font-medium text-primary-foreground">
              슬라이드 제작
            </button>
            <button id="menu-assets" class="flex w-full items-center rounded-md border border-border bg-background px-3 py-2 text-sm font-medium text-foreground hover:bg-muted">
              로고&아트워크 관리
            </button>
          </nav>
        </div>
      </aside>

      <main class="flex-1 p-4 md:p-6 lg:p-8">
        <section id="view-editor">
          <div class="mb-6">
            <h2 class="text-2xl font-bold tracking-tight">슬라이드 제작</h2>
            <p class="mt-1 text-sm text-muted-foreground">제품 정보를 입력하여 스펙 시트를 생성합니다.</p>
          </div>

          <div class="rounded-lg border border-border bg-card text-card-foreground">
            <div class="border-b border-border px-4 pt-4">
              <div class="flex gap-2">
                <button id="tab-input" class="rounded-t-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground">정보 입력</button>
                <button id="tab-queue" class="rounded-t-md bg-muted px-3 py-2 text-sm font-medium text-foreground">생성 대기열</button>
              </div>
            </div>

            <div id="tab-input-panel" class="space-y-6 p-4 md:p-5">
              <section>
                <h3 class="text-base font-semibold">1. 기본 정보</h3>
                <div class="mt-3 grid grid-cols-1 gap-3 md:grid-cols-2">
                  <div>
                    <label class="mb-1.5 block text-xs font-medium text-muted-foreground">시즌 아이템명</label>
                    <input id="season_item" value="JETSET LUXE" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
                  </div>
                  <div>
                    <label class="mb-1.5 block text-xs font-medium text-muted-foreground">시즌 텍스트 색상</label>
                    <input id="season_color" type="color" value="#000000" class="h-10 w-full rounded-md border border-input bg-background px-2 py-2" />
                  </div>
                  <div>
                    <label class="mb-1.5 block text-xs font-medium text-muted-foreground">제품명</label>
                    <input id="name" value="MEN'S T-SHIRTS" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
                  </div>
                  <div>
                    <label class="mb-1.5 block text-xs font-medium text-muted-foreground">품번 (필수)</label>
                    <input id="code" placeholder="예: BKFTM1581" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring" />
                  </div>
                </div>
              </section>

              <section class="border-t border-border pt-2">
                <h3 class="text-base font-semibold">2. 디자인 자산</h3>
                <div class="mt-3 space-y-3">
                  <div class="rounded-md border border-dashed border-border bg-muted p-3">
                    <label class="mb-1.5 block text-xs font-medium">메인 이미지</label>
                    <input id="main_image" type="file" accept=".png,.jpg,.jpeg" class="w-full text-sm" />
                    <p id="mainImageHint" class="mt-1 text-xs text-muted-foreground">슬라이드 좌측에 크게 들어갈 이미지</p>
                  </div>

                  <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
                    <div>
                      <label class="mb-1.5 block text-xs font-medium text-muted-foreground">로고 선택</label>
                      <input id="logo" value="선택 없음" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm" />
                    </div>
                    <div>
                      <label class="mb-1.5 block text-xs font-medium text-muted-foreground">아트워크 선택 (콤마)</label>
                      <input id="artworks" placeholder="logo_line.png, emblem.svg" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm" />
                    </div>
                  </div>
                </div>
              </section>

              <section class="border-t border-border pt-2">
                <h3 class="text-base font-semibold">3. 컬러웨이 (Colorways)</h3>
                <div class="mt-3 rounded-md border border-dashed border-border bg-muted p-3">
                  <label class="mb-1.5 block text-xs font-medium">컬러웨이 이미지 업로드 (최대 4개)</label>
                  <input id="color_images" type="file" accept=".png,.jpg,.jpeg" multiple class="w-full text-sm" />
                  <p class="mt-1 text-xs text-muted-foreground">업로드 후 색상명과 순서를 지정하세요.</p>
                </div>
                <div id="colorway-list" class="mt-3 space-y-2"></div>
              </section>

              <div class="pt-2">
                <button id="addQueueBtn" class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground hover:opacity-90">대기열에 추가</button>
                <p id="inputStatus" class="mt-2 text-sm text-muted-foreground"></p>
              </div>
            </div>

            <div id="tab-queue-panel" class="hidden space-y-4 p-4 md:p-5">
              <div class="flex items-center justify-between">
                <h3 id="queueTitle" class="text-base font-semibold">생성 대기 목록 (0)</h3>
                <button id="clearQueueBtn" class="rounded-md border border-border bg-background px-3 py-2 text-xs font-medium hover:bg-muted">목록 비우기</button>
              </div>
              <div id="queueList" class="space-y-2"></div>
              <div class="border-t border-border pt-2">
                <label class="mb-1.5 block text-xs font-medium text-muted-foreground">API Base URL</label>
                <input id="apiBase" value="https://overviewmaker.onrender.com" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring md:w-[420px]" />
                <button id="generateBtn" class="mt-3 inline-flex items-center justify-center rounded-md bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60">PPT 생성 및 다운로드</button>
                <p id="queueStatus" class="mt-2 text-sm text-muted-foreground"></p>
              </div>
            </div>
          </div>
        </section>

        <section id="view-assets" class="hidden">
          <div class="mb-6">
            <h2 class="text-2xl font-bold tracking-tight">자산 관리</h2>
            <p class="mt-1 text-sm text-muted-foreground">디자인 자산을 업로드하고 관리합니다.</p>
          </div>

          <div class="space-y-4 rounded-lg border border-border bg-card p-5 text-card-foreground">
            <div>
              <label class="mb-1.5 block text-xs font-medium text-muted-foreground">API Base URL</label>
              <input id="assetApiBase" value="https://overviewmaker.onrender.com" class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-ring md:w-[420px]" />
            </div>
            <div class="flex gap-2">
              <button id="asset-tab-logo" class="rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground">로고</button>
              <button id="asset-tab-art" class="rounded-md bg-muted px-3 py-2 text-sm font-medium text-foreground">아트워크</button>
            </div>

            <div id="artCallout" class="hidden rounded-md border border-border bg-muted p-3 text-xs text-muted-foreground">
              아트워크 타입 안내
              <br />- 기본: 높이 20mm (너비 자동)
              <br />- 가로 타입: 너비 30mm (높이 자동) - 가로로 긴 형태의 아트워크인 경우 선택해주세요
              <br />- 작은 아트워크: 너비 12mm (높이 자동) - 사이즈가 작은 아트워크인 경우 선택
            </div>

            <div class="rounded-md border border-dashed border-border bg-muted p-3">
              <label class="mb-1.5 block text-xs font-medium">파일 업로드</label>
              <input id="asset-upload-input" type="file" multiple class="w-full text-sm" />
              <button id="asset-upload-btn" class="mt-3 rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground">저장하기</button>
              <p id="assetStatus" class="mt-2 text-sm text-muted-foreground"></p>
            </div>

            <div>
              <h3 class="text-sm font-semibold">보유 파일 목록</h3>
              <div id="asset-list" class="mt-2 grid grid-cols-2 gap-3 md:grid-cols-4"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);

      const state = {
        selectedMenu: 'editor',
        selectedTab: 'input',
        selectedAssetTab: 'logo',
        queue: [],
        colorways: [],
        assets: [],
        artworkMeta: {},
      };

      function getApiBase() {
        const fromAsset = ($('assetApiBase')?.value || '').trim();
        const fromQueue = ($('apiBase')?.value || '').trim();
        return (fromAsset || fromQueue || 'https://overviewmaker.onrender.com').replace(/\/$/, '');
      }

      function syncApiBaseInputs(source) {
        const value = (source?.value || '').trim();
        if ($('apiBase') && source !== $('apiBase')) $('apiBase').value = value;
        if ($('assetApiBase') && source !== $('assetApiBase')) $('assetApiBase').value = value;
      }

      function setMenu(menu) {
        const isEditor = menu === 'editor';
        $('view-editor').classList.toggle('hidden', !isEditor);
        $('view-assets').classList.toggle('hidden', isEditor);
        $('menu-editor').className = isEditor
          ? 'flex w-full items-center rounded-md border border-primary bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'flex w-full items-center rounded-md border border-border bg-background px-3 py-2 text-sm font-medium text-foreground hover:bg-muted';
        $('menu-assets').className = !isEditor
          ? 'flex w-full items-center rounded-md border border-primary bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'flex w-full items-center rounded-md border border-border bg-background px-3 py-2 text-sm font-medium text-foreground hover:bg-muted';
      }

      function setTab(tab) {
        const isInput = tab === 'input';
        $('tab-input-panel').classList.toggle('hidden', !isInput);
        $('tab-queue-panel').classList.toggle('hidden', isInput);
        $('tab-input').className = isInput
          ? 'rounded-t-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'rounded-t-md bg-muted px-3 py-2 text-sm font-medium text-foreground';
        $('tab-queue').className = !isInput
          ? 'rounded-t-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'rounded-t-md bg-muted px-3 py-2 text-sm font-medium text-foreground';
      }

      function setAssetTab(tab) {
        const isLogo = tab === 'logo';
        state.selectedAssetTab = tab;
        $('asset-tab-logo').className = isLogo
          ? 'rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'rounded-md bg-muted px-3 py-2 text-sm font-medium text-foreground';
        $('asset-tab-art').className = !isLogo
          ? 'rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground'
          : 'rounded-md bg-muted px-3 py-2 text-sm font-medium text-foreground';
        $('artCallout').classList.toggle('hidden', isLogo);
        loadAssets();
      }

      function setAssetStatus(msg, tone = 'normal') {
        const el = $('assetStatus');
        if (!el) return;
        el.textContent = msg;
        el.className = 'mt-2 text-sm ' + (tone === 'error' ? 'text-red-600' : tone === 'success' ? 'text-emerald-600' : 'text-muted-foreground');
      }

      function renderAssets() {
        const list = $('asset-list');
        list.innerHTML = '';
        if (state.assets.length === 0) {
          const empty = document.createElement('div');
          empty.className = 'col-span-full rounded-md border border-border bg-muted px-3 py-2 text-sm text-muted-foreground';
          empty.textContent = '파일이 없습니다.';
          list.appendChild(empty);
          return;
        }

        const apiBase = getApiBase();
        const isArtwork = state.selectedAssetTab === 'art';
        state.assets.forEach((item) => {
          const card = document.createElement('div');
          card.className = 'rounded-md border border-border bg-card p-2';
          const safeName = item.name.replace(/'/g, '&#39;');
          const imgUrl = `${apiBase}${item.url}`;
          card.innerHTML = `
            <img src="${imgUrl}" alt="${safeName}" class="h-28 w-full rounded-md border border-border object-contain bg-background" />
            <p class="mt-2 truncate text-xs text-muted-foreground">${safeName}</p>
            ${isArtwork ? `
            <div class="mt-2 space-y-1 text-xs">
              <label class="flex items-center gap-1"><input type="radio" name="mode_${safeName}" value="default" ${state.artworkMeta[item.name] === 'default' ? 'checked' : ''} /> 기본</label>
              <label class="flex items-center gap-1"><input type="radio" name="mode_${safeName}" value="horizontal" ${state.artworkMeta[item.name] === 'horizontal' ? 'checked' : ''} /> 가로 타입</label>
              <label class="flex items-center gap-1"><input type="radio" name="mode_${safeName}" value="small" ${state.artworkMeta[item.name] === 'small' ? 'checked' : ''} /> 작은 아트워크</label>
            </div>` : ''}
            <button class="mt-2 rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted" data-del="${safeName}">삭제</button>
          `;
          list.appendChild(card);

          card.querySelector('[data-del]').addEventListener('click', async () => {
            try {
              const kind = state.selectedAssetTab === 'logo' ? 'logo' : 'artwork';
              const res = await fetch(`${apiBase}/api/assets?kind=${encodeURIComponent(kind)}&name=${encodeURIComponent(item.name)}`, { method: 'DELETE' });
              if (!res.ok) throw new Error(await res.text());
              setAssetStatus('삭제 완료', 'success');
              await loadAssets();
            } catch (e) {
              setAssetStatus(`삭제 실패: ${e.message}`, 'error');
            }
          });

          if (isArtwork) {
            const radios = card.querySelectorAll(`input[name="mode_${safeName}"]`);
            radios.forEach((radio) => {
              radio.addEventListener('change', async (ev) => {
                const mode = ev.target.value;
                try {
                  const fd = new FormData();
                  fd.append('name', item.name);
                  fd.append('mode', mode);
                  const res = await fetch(`${apiBase}/api/assets/artwork-mode`, { method: 'POST', body: fd });
                  if (!res.ok) throw new Error(await res.text());
                  state.artworkMeta[item.name] = mode;
                  setAssetStatus('타입 저장 완료', 'success');
                } catch (e) {
                  setAssetStatus(`타입 저장 실패: ${e.message}`, 'error');
                }
              });
            });
          }
        });
      }

      async function loadAssets() {
        try {
          const apiBase = getApiBase();
          const kind = state.selectedAssetTab === 'logo' ? 'logo' : 'artwork';
          const res = await fetch(`${apiBase}/api/assets?kind=${encodeURIComponent(kind)}`);
          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();
          state.assets = data.files || [];
          state.artworkMeta = data.meta || {};
          renderAssets();
        } catch (e) {
          setAssetStatus(`목록 조회 실패: ${e.message}`, 'error');
        }
      }

      function renderColorways() {
        const list = $('colorway-list');
        list.innerHTML = '';

        if (state.colorways.length === 0) {
          const empty = document.createElement('p');
          empty.className = 'text-xs text-muted-foreground';
          empty.textContent = '업로드된 컬러웨이가 없습니다.';
          list.appendChild(empty);
          return;
        }

        state.colorways.forEach((item, idx) => {
          const row = document.createElement('div');
          row.className = 'grid grid-cols-[56px_minmax(0,1fr)_40px_40px] items-center gap-2 rounded-md border border-border bg-card p-2';

          const thumb = document.createElement('img');
          thumb.src = item.preview;
          thumb.className = 'h-14 w-14 rounded-md border border-border object-cover';

          const input = document.createElement('input');
          input.value = item.name || '';
          input.placeholder = `색상명 ${idx + 1}`;
          input.className = 'w-full rounded-md border border-input bg-background px-3 py-2 text-sm';
          input.addEventListener('input', (e) => {
            state.colorways[idx].name = e.target.value;
          });

          const up = document.createElement('button');
          up.textContent = '↑';
          up.disabled = idx === 0;
          up.className = 'rounded-md border border-border bg-background px-2 py-2 text-sm disabled:opacity-40';
          up.addEventListener('click', () => {
            if (idx === 0) return;
            [state.colorways[idx - 1], state.colorways[idx]] = [state.colorways[idx], state.colorways[idx - 1]];
            renderColorways();
          });

          const down = document.createElement('button');
          down.textContent = '↓';
          down.disabled = idx === state.colorways.length - 1;
          down.className = 'rounded-md border border-border bg-background px-2 py-2 text-sm disabled:opacity-40';
          down.addEventListener('click', () => {
            if (idx === state.colorways.length - 1) return;
            [state.colorways[idx + 1], state.colorways[idx]] = [state.colorways[idx], state.colorways[idx + 1]];
            renderColorways();
          });

          row.appendChild(thumb);
          row.appendChild(input);
          row.appendChild(up);
          row.appendChild(down);
          list.appendChild(row);
        });
      }

      function renderQueue() {
        $('queueTitle').textContent = `생성 대기 목록 (${state.queue.length})`;
        const list = $('queueList');
        list.innerHTML = '';

        if (state.queue.length === 0) {
          const empty = document.createElement('div');
          empty.className = 'rounded-md border border-border bg-muted px-3 py-2 text-sm text-muted-foreground';
          empty.textContent = '대기 중인 항목이 없습니다.';
          list.appendChild(empty);
          return;
        }

        state.queue.forEach((item, idx) => {
          const row = document.createElement('div');
          row.className = 'rounded-md border border-border bg-card p-3';
          row.innerHTML = `
            <p class="text-sm font-medium">${idx + 1}. ${item.code} - ${item.name}</p>
            <p class="mt-1 text-xs text-muted-foreground">컬러: ${item.colors.length}개 | 로고: ${item.logo} | 아트워크: ${item.artworks || '-'}</p>
          `;
          list.appendChild(row);
        });
      }

      function setStatus(id, msg, type = 'normal') {
        const el = $(id);
        if (!el) return;
        el.textContent = msg;
        el.className = 'mt-2 text-sm ' + (type === 'error' ? 'text-red-600' : type === 'success' ? 'text-emerald-600' : 'text-muted-foreground');
      }

      $('menu-editor').addEventListener('click', () => setMenu('editor'));
      $('menu-assets').addEventListener('click', () => setMenu('assets'));
      $('tab-input').addEventListener('click', () => setTab('input'));
      $('tab-queue').addEventListener('click', () => setTab('queue'));
      $('asset-tab-logo').addEventListener('click', () => setAssetTab('logo'));
      $('asset-tab-art').addEventListener('click', () => setAssetTab('art'));
      $('apiBase').addEventListener('input', (e) => syncApiBaseInputs(e.target));
      $('assetApiBase').addEventListener('input', (e) => syncApiBaseInputs(e.target));
      $('asset-upload-btn').addEventListener('click', async () => {
        const files = $('asset-upload-input').files;
        if (!files || files.length === 0) {
          setAssetStatus('업로드할 파일을 선택하세요.', 'error');
          return;
        }

        const apiBase = getApiBase();
        const kind = state.selectedAssetTab === 'logo' ? 'logo' : 'artwork';
        const fd = new FormData();
        fd.append('kind', kind);
        for (const f of files) fd.append('files', f);

        try {
          setAssetStatus('업로드 중...');
          const res = await fetch(`${apiBase}/api/assets/upload`, { method: 'POST', body: fd });
          if (!res.ok) throw new Error(await res.text());
          $('asset-upload-input').value = '';
          setAssetStatus('업로드 완료', 'success');
          await loadAssets();
        } catch (e) {
          setAssetStatus(`업로드 실패: ${e.message}`, 'error');
        }
      });

      $('main_image').addEventListener('change', () => {
        const f = $('main_image').files && $('main_image').files[0];
        $('mainImageHint').textContent = f ? `선택됨: ${f.name}` : '슬라이드 좌측에 크게 들어갈 이미지';
      });

      $('color_images').addEventListener('change', () => {
        const files = Array.from($('color_images').files || []).slice(0, 4);
        state.colorways = files.map((f) => ({
          file: f,
          name: '',
          preview: URL.createObjectURL(f),
        }));
        renderColorways();
      });

      $('addQueueBtn').addEventListener('click', () => {
        const mainImage = $('main_image').files && $('main_image').files[0];
        const code = ($('code').value || '').trim();
        if (!code || !mainImage) {
          setStatus('inputStatus', '품번과 메인 이미지는 필수입니다.', 'error');
          return;
        }

        state.queue.push({
          season_item: $('season_item').value || '',
          season_color: $('season_color').value || '#000000',
          name: $('name').value || '',
          code,
          logo: $('logo').value || '선택 없음',
          artworks: $('artworks').value || '',
          main_image: mainImage,
          colors: state.colorways.map((c) => ({ img: c.file, name: c.name || '' })),
        });

        renderQueue();
        setStatus('inputStatus', `'${code}' 대기열에 추가됨`, 'success');
      });

      $('clearQueueBtn').addEventListener('click', () => {
        state.queue = [];
        renderQueue();
        setStatus('queueStatus', '목록을 비웠습니다.');
      });

      $('generateBtn').addEventListener('click', async () => {
        if (state.queue.length === 0) {
          setStatus('queueStatus', '대기열이 비어 있습니다.', 'error');
          return;
        }

        const item = state.queue[0];
        const apiBase = ($('apiBase').value || '').trim().replace(/\/$/, '');
        const fd = new FormData();
        fd.append('season_item', item.season_item);
        fd.append('season_color', item.season_color);
        fd.append('name', item.name);
        fd.append('code', item.code);
        fd.append('logo', item.logo);
        fd.append('artworks', item.artworks);
        fd.append('color_names', item.colors.map((c) => c.name || '').join(','));
        fd.append('main_image', item.main_image);
        for (const c of item.colors) {
          if (c.img) fd.append('color_images', c.img);
        }

        const btn = $('generateBtn');
        btn.disabled = true;
        setStatus('queueStatus', '생성 중...');

        try {
          const res = await fetch(`${apiBase}/api/generate`, { method: 'POST', body: fd });
          if (!res.ok) {
            const text = await res.text();
            throw new Error(`${res.status} ${text}`);
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'BOSS_Golf_SpecSheet.pptx';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          setStatus('queueStatus', '완료: PPT 다운로드를 확인하세요.', 'success');
        } catch (e) {
          setStatus('queueStatus', `실패: ${e.message}`, 'error');
        } finally {
          btn.disabled = false;
        }
      });

      setMenu('editor');
      setTab('input');
      syncApiBaseInputs($('assetApiBase'));
      setAssetTab('logo');
      renderColorways();
      renderQueue();
    </script>
  </body>
</html>
